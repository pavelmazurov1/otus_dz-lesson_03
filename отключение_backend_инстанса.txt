отключение backend-инстанса:

pavel.mazurov@F7GM2K6971-MBP otus_dz-lesson_03 % docker kill backend1
backend1

pavel.mazurov@F7GM2K6971-MBP otus_dz-lesson_03 % docker ps         
CONTAINER ID   IMAGE                               COMMAND                  CREATED          STATUS          PORTS                    NAMES
e2a05899ebb7   otus_dz-lesson_03-nginx             "/docker-entrypoint.…"   10 minutes ago   Up 10 minutes   0.0.0.0:8080->80/tcp     nginx
530f07de2a9a   otus_dz-lesson_03-backend2          "python app.py"          10 minutes ago   Up 10 minutes   5000/tcp                 backend2
cf03ff75891c   otus_dz-lesson_03-haproxy           "docker-entrypoint.s…"   10 minutes ago   Up 10 minutes   0.0.0.0:5432->5432/tcp   haproxy
f4c8cdfceb0b   otus_dz-lesson_03-postgres-slave1   "docker-entrypoint.s…"   10 minutes ago   Up 2 minutes    0.0.0.0:5433->5432/tcp   postgres-slave1
6a5e24df0a07   otus_dz-lesson_03-postgres-slave2   "docker-entrypoint.s…"   10 minutes ago   Up 10 minutes   0.0.0.0:5434->5432/tcp   postgres-slave2

pavel.mazurov@F7GM2K6971-MBP otus_dz-lesson_03 % ./load-test/run.sh
Send 20 requests to http://localhost:8080/data...
{"backend_id":"backend2","postgres_ip":"172.22.0.3","timestamp":"2025-11-16 11:02:08.721402+00:00"}
{"backend_id":"backend2","postgres_ip":"172.22.0.2","timestamp":"2025-11-16 11:02:09.352735+00:00"}
{"backend_id":"backend2","postgres_ip":"172.22.0.3","timestamp":"2025-11-16 11:02:13.033429+00:00"}
{"backend_id":"backend2","postgres_ip":"172.22.0.2","timestamp":"2025-11-16 11:02:13.664534+00:00"}
{"backend_id":"backend2","postgres_ip":"172.22.0.3","timestamp":"2025-11-16 11:02:14.331144+00:00"}
{"backend_id":"backend2","postgres_ip":"172.22.0.2","timestamp":"2025-11-16 11:02:14.910349+00:00"}
{"backend_id":"backend2","postgres_ip":"172.22.0.3","timestamp":"2025-11-16 11:02:15.462892+00:00"}
{"backend_id":"backend2","postgres_ip":"172.22.0.2","timestamp":"2025-11-16 11:02:16.071466+00:00"}
{"backend_id":"backend2","postgres_ip":"172.22.0.3","timestamp":"2025-11-16 11:02:19.804573+00:00"}
{"backend_id":"backend2","postgres_ip":"172.22.0.2","timestamp":"2025-11-16 11:02:20.368199+00:00"}
{"backend_id":"backend2","postgres_ip":"172.22.0.3","timestamp":"2025-11-16 11:02:21.021253+00:00"}
{"backend_id":"backend2","postgres_ip":"172.22.0.2","timestamp":"2025-11-16 11:02:21.668813+00:00"}
{"backend_id":"backend2","postgres_ip":"172.22.0.3","timestamp":"2025-11-16 11:02:22.274696+00:00"}
{"backend_id":"backend2","postgres_ip":"172.22.0.2","timestamp":"2025-11-16 11:02:22.902340+00:00"}
{"backend_id":"backend2","postgres_ip":"172.22.0.3","timestamp":"2025-11-16 11:02:23.540630+00:00"}
{"backend_id":"backend2","postgres_ip":"172.22.0.2","timestamp":"2025-11-16 11:02:24.113893+00:00"}
{"backend_id":"backend2","postgres_ip":"172.22.0.3","timestamp":"2025-11-16 11:02:24.718315+00:00"}
{"backend_id":"backend2","postgres_ip":"172.22.0.2","timestamp":"2025-11-16 11:02:25.335010+00:00"}
{"backend_id":"backend2","postgres_ip":"172.22.0.3","timestamp":"2025-11-16 11:02:29.053701+00:00"}
{"backend_id":"backend2","postgres_ip":"172.22.0.2","timestamp":"2025-11-16 11:02:29.672096+00:00"}

По логам выше видно, что nginx продолжает слать трафик на второй бэк - приложение остаётся доступным, nginx перенаправляет запросы

Логи nginx:
pavel.mazurov@F7GM2K6971-MBP otus_dz-lesson_03 % docker-compose logs nginx
nginx  | /docker-entrypoint.sh: /docker-entrypoint.d/ is not empty, will attempt to perform configuration
nginx  | /docker-entrypoint.sh: Looking for shell scripts in /docker-entrypoint.d/
nginx  | /docker-entrypoint.sh: Launching /docker-entrypoint.d/10-listen-on-ipv6-by-default.sh
nginx  | 10-listen-on-ipv6-by-default.sh: info: Getting the checksum of /etc/nginx/conf.d/default.conf
nginx  | 10-listen-on-ipv6-by-default.sh: info: Enabled listen on IPv6 in /etc/nginx/conf.d/default.conf
nginx  | /docker-entrypoint.sh: Sourcing /docker-entrypoint.d/15-local-resolvers.envsh
nginx  | /docker-entrypoint.sh: Launching /docker-entrypoint.d/20-envsubst-on-templates.sh
nginx  | /docker-entrypoint.sh: Launching /docker-entrypoint.d/30-tune-worker-processes.sh
nginx  | /docker-entrypoint.sh: Configuration complete; ready for start up
nginx  | 172.22.0.1 - - [16/Nov/2025:10:55:29 +0000] "GET /data HTTP/1.1" 200 100 "-" "curl/7.88.1"
nginx  | 172.22.0.1 - - [16/Nov/2025:10:55:30 +0000] "GET /data HTTP/1.1" 200 100 "-" "curl/7.88.1"
nginx  | 172.22.0.1 - - [16/Nov/2025:10:55:31 +0000] "GET /data HTTP/1.1" 200 100 "-" "curl/7.88.1"
nginx  | 172.22.0.1 - - [16/Nov/2025:10:55:31 +0000] "GET /data HTTP/1.1" 200 100 "-" "curl/7.88.1"
nginx  | 172.22.0.1 - - [16/Nov/2025:10:55:32 +0000] "GET /data HTTP/1.1" 200 100 "-" "curl/7.88.1"
nginx  | 172.22.0.1 - - [16/Nov/2025:10:55:33 +0000] "GET /data HTTP/1.1" 200 100 "-" "curl/7.88.1"
nginx  | 172.22.0.1 - - [16/Nov/2025:10:55:33 +0000] "GET /data HTTP/1.1" 200 100 "-" "curl/7.88.1"
nginx  | 172.22.0.1 - - [16/Nov/2025:10:55:34 +0000] "GET /data HTTP/1.1" 200 100 "-" "curl/7.88.1"
nginx  | 172.22.0.1 - - [16/Nov/2025:10:55:35 +0000] "GET /data HTTP/1.1" 200 100 "-" "curl/7.88.1"
nginx  | 172.22.0.1 - - [16/Nov/2025:10:55:35 +0000] "GET /data HTTP/1.1" 200 100 "-" "curl/7.88.1"
nginx  | 172.22.0.1 - - [16/Nov/2025:10:55:36 +0000] "GET /data HTTP/1.1" 200 100 "-" "curl/7.88.1"
nginx  | 172.22.0.1 - - [16/Nov/2025:10:55:36 +0000] "GET /data HTTP/1.1" 200 100 "-" "curl/7.88.1"
nginx  | 172.22.0.1 - - [16/Nov/2025:10:55:37 +0000] "GET /data HTTP/1.1" 200 100 "-" "curl/7.88.1"
nginx  | 172.22.0.1 - - [16/Nov/2025:10:55:37 +0000] "GET /data HTTP/1.1" 200 100 "-" "curl/7.88.1"
nginx  | 172.22.0.1 - - [16/Nov/2025:10:55:38 +0000] "GET /data HTTP/1.1" 200 100 "-" "curl/7.88.1"
nginx  | 172.22.0.1 - - [16/Nov/2025:10:55:39 +0000] "GET /data HTTP/1.1" 200 100 "-" "curl/7.88.1"
nginx  | 172.22.0.1 - - [16/Nov/2025:10:55:39 +0000] "GET /data HTTP/1.1" 200 100 "-" "curl/7.88.1"
nginx  | 172.22.0.1 - - [16/Nov/2025:10:55:40 +0000] "GET /data HTTP/1.1" 200 100 "-" "curl/7.88.1"
nginx  | 172.22.0.1 - - [16/Nov/2025:10:55:41 +0000] "GET /data HTTP/1.1" 200 100 "-" "curl/7.88.1"
nginx  | 172.22.0.1 - - [16/Nov/2025:10:55:41 +0000] "GET /data HTTP/1.1" 200 100 "-" "curl/7.88.1"
nginx  | 172.22.0.1 - - [16/Nov/2025:10:57:46 +0000] "GET /data HTTP/1.1" 200 100 "-" "curl/7.88.1"
nginx  | 172.22.0.1 - - [16/Nov/2025:10:57:46 +0000] "GET /data HTTP/1.1" 200 100 "-" "curl/7.88.1"
nginx  | 172.22.0.1 - - [16/Nov/2025:10:57:47 +0000] "GET /data HTTP/1.1" 200 100 "-" "curl/7.88.1"
nginx  | 172.22.0.1 - - [16/Nov/2025:10:57:47 +0000] "GET /data HTTP/1.1" 200 100 "-" "curl/7.88.1"
nginx  | 172.22.0.1 - - [16/Nov/2025:10:57:48 +0000] "GET /data HTTP/1.1" 200 100 "-" "curl/7.88.1"
nginx  | 172.22.0.1 - - [16/Nov/2025:10:57:49 +0000] "GET /data HTTP/1.1" 200 100 "-" "curl/7.88.1"
nginx  | 172.22.0.1 - - [16/Nov/2025:10:57:49 +0000] "GET /data HTTP/1.1" 200 100 "-" "curl/7.88.1"
nginx  | 172.22.0.1 - - [16/Nov/2025:10:57:50 +0000] "GET /data HTTP/1.1" 200 100 "-" "curl/7.88.1"
nginx  | 172.22.0.1 - - [16/Nov/2025:10:57:51 +0000] "GET /data HTTP/1.1" 200 100 "-" "curl/7.88.1"
nginx  | 172.22.0.1 - - [16/Nov/2025:10:57:51 +0000] "GET /data HTTP/1.1" 200 100 "-" "curl/7.88.1"
nginx  | 172.22.0.1 - - [16/Nov/2025:10:57:52 +0000] "GET /data HTTP/1.1" 200 100 "-" "curl/7.88.1"
nginx  | 172.22.0.1 - - [16/Nov/2025:10:57:52 +0000] "GET /data HTTP/1.1" 200 100 "-" "curl/7.88.1"
nginx  | 172.22.0.1 - - [16/Nov/2025:10:57:53 +0000] "GET /data HTTP/1.1" 200 100 "-" "curl/7.88.1"
nginx  | 172.22.0.1 - - [16/Nov/2025:10:57:54 +0000] "GET /data HTTP/1.1" 200 100 "-" "curl/7.88.1"
nginx  | 172.22.0.1 - - [16/Nov/2025:10:57:54 +0000] "GET /data HTTP/1.1" 200 100 "-" "curl/7.88.1"
nginx  | 172.22.0.1 - - [16/Nov/2025:10:57:55 +0000] "GET /data HTTP/1.1" 200 100 "-" "curl/7.88.1"
nginx  | 172.22.0.1 - - [16/Nov/2025:10:57:56 +0000] "GET /data HTTP/1.1" 200 100 "-" "curl/7.88.1"
nginx  | 172.22.0.1 - - [16/Nov/2025:10:57:56 +0000] "GET /data HTTP/1.1" 200 100 "-" "curl/7.88.1"
nginx  | 172.22.0.1 - - [16/Nov/2025:10:57:57 +0000] "GET /data HTTP/1.1" 200 100 "-" "curl/7.88.1"
nginx  | 172.22.0.1 - - [16/Nov/2025:10:57:57 +0000] "GET /data HTTP/1.1" 200 100 "-" "curl/7.88.1"
nginx  | 2025/11/16 11:02:08 [error] 30#30: *81 connect() failed (113: Host is unreachable) while connecting to upstream, client: 172.22.0.1, server: , request: "GET /data HTTP/1.1", upstream: "http://172.22.0.6:5000/data", host: "localhost:8080"
nginx  | 172.22.0.1 - - [16/Nov/2025:11:02:08 +0000] "GET /data HTTP/1.1" 200 100 "-" "curl/7.88.1"
nginx  | 172.22.0.1 - - [16/Nov/2025:11:02:09 +0000] "GET /data HTTP/1.1" 200 100 "-" "curl/7.88.1"
nginx  | 2025/11/16 11:02:13 [error] 30#30: *86 connect() failed (113: Host is unreachable) while connecting to upstream, client: 172.22.0.1, server: , request: "GET /data HTTP/1.1", upstream: "http://172.22.0.6:5000/data", host: "localhost:8080"
nginx  | 172.22.0.1 - - [16/Nov/2025:11:02:13 +0000] "GET /data HTTP/1.1" 200 100 "-" "curl/7.88.1"
nginx  | 172.22.0.1 - - [16/Nov/2025:11:02:13 +0000] "GET /data HTTP/1.1" 200 100 "-" "curl/7.88.1"
nginx  | 172.22.0.1 - - [16/Nov/2025:11:02:14 +0000] "GET /data HTTP/1.1" 200 100 "-" "curl/7.88.1"
nginx  | 172.22.0.1 - - [16/Nov/2025:11:02:14 +0000] "GET /data HTTP/1.1" 200 100 "-" "curl/7.88.1"
nginx  | 172.22.0.1 - - [16/Nov/2025:11:02:15 +0000] "GET /data HTTP/1.1" 200 100 "-" "curl/7.88.1"
nginx  | 172.22.0.1 - - [16/Nov/2025:11:02:16 +0000] "GET /data HTTP/1.1" 200 100 "-" "curl/7.88.1"
nginx  | 2025/11/16 11:02:19 [error] 30#30: *99 connect() failed (113: Host is unreachable) while connecting to upstream, client: 172.22.0.1, server: , request: "GET /data HTTP/1.1", upstream: "http://172.22.0.6:5000/data", host: "localhost:8080"
nginx  | 172.22.0.1 - - [16/Nov/2025:11:02:19 +0000] "GET /data HTTP/1.1" 200 100 "-" "curl/7.88.1"
nginx  | 172.22.0.1 - - [16/Nov/2025:11:02:20 +0000] "GET /data HTTP/1.1" 200 100 "-" "curl/7.88.1"
nginx  | 172.22.0.1 - - [16/Nov/2025:11:02:21 +0000] "GET /data HTTP/1.1" 200 100 "-" "curl/7.88.1"
nginx  | 172.22.0.1 - - [16/Nov/2025:11:02:21 +0000] "GET /data HTTP/1.1" 200 100 "-" "curl/7.88.1"
nginx  | 172.22.0.1 - - [16/Nov/2025:11:02:22 +0000] "GET /data HTTP/1.1" 200 100 "-" "curl/7.88.1"
nginx  | 2025/11/16 11:02:22 [error] 30#30: *110 connect() failed (113: Host is unreachable) while connecting to upstream, client: 172.22.0.1, server: , request: "GET /data HTTP/1.1", upstream: "http://172.22.0.6:5000/data", host: "localhost:8080"
nginx  | 172.22.0.1 - - [16/Nov/2025:11:02:22 +0000] "GET /data HTTP/1.1" 200 100 "-" "curl/7.88.1"
nginx  | 172.22.0.1 - - [16/Nov/2025:11:02:23 +0000] "GET /data HTTP/1.1" 200 100 "-" "curl/7.88.1"
nginx  | 172.22.0.1 - - [16/Nov/2025:11:02:24 +0000] "GET /data HTTP/1.1" 200 100 "-" "curl/7.88.1"
nginx  | 172.22.0.1 - - [16/Nov/2025:11:02:24 +0000] "GET /data HTTP/1.1" 200 100 "-" "curl/7.88.1"
nginx  | 172.22.0.1 - - [16/Nov/2025:11:02:25 +0000] "GET /data HTTP/1.1" 200 100 "-" "curl/7.88.1"
nginx  | 2025/11/16 11:02:29 [error] 30#30: *121 connect() failed (113: Host is unreachable) while connecting to upstream, client: 172.22.0.1, server: , request: "GET /data HTTP/1.1", upstream: "http://172.22.0.6:5000/data", host: "localhost:8080"
nginx  | 172.22.0.1 - - [16/Nov/2025:11:02:29 +0000] "GET /data HTTP/1.1" 200 100 "-" "curl/7.88.1"
nginx  | 172.22.0.1 - - [16/Nov/2025:11:02:29 +0000] "GET /data HTTP/1.1" 200 100 "-" "curl/7.88.1"